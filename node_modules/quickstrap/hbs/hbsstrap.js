var fs = require('fs');

module.exports.createLayoutAndIndexFiles = function(path){
	var layout = fs.readFileSync(__dirname + "/hbslayout.txt");
	fs.writeFileSync(path + "/views/layout.hbs",layout);

	var index = fs.readFileSync(__dirname + "/hbsindex.txt");
	fs.writeFileSync(path + "/views/index.hbs",index);
	changeHjsToHbsInPackage(path);
	changeHjsRequireToHbs(path);
	fs.unlinkSync(path + "/views/index.hjs");
}

function changeHjsToHbsInPackage(path){
	var packageFilePath = path + "/package.json";
	var packageJson = JSON.parse(fs.readFileSync(packageFilePath,"utf8"));
	delete packageJson.dependencies.hjs;
	packageJson.dependencies["hbs"] = "*";
	fs.writeFileSync(packageFilePath, JSON.stringify(packageJson,null, 4), "utf8");
}

function changeHjsRequireToHbs(path){
	var appJs = fs.readFileSync(path + "/app.js", "utf8");
	appJs = appJs.replace("app.set('view engine', 'hjs')", "app.set('view engine', 'hbs')")
	fs.writeFileSync(path + "/app.js" ,appJs);
}