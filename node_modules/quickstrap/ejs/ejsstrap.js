var fs = require('fs');

module.exports.createLayoutAndIndexFiles = function(path){
	var layout = fs.readFileSync(__dirname + "/ejslayout.txt");
	fs.writeFileSync(path + "/views/layout.ejs",layout);

	var index = fs.readFileSync(__dirname + "/ejsindex.txt");
	fs.writeFileSync(path + "/views/index.ejs",index);
	addEjsLayoutsToPackage(path);
	addEjsRequireToApp(path);
}

function addEjsLayoutsToPackage(path){
	var packageFilePath = path + "/package.json";
	var packageJson = JSON.parse(fs.readFileSync(packageFilePath,"utf8"));
	packageJson.dependencies["express-ejs-layouts"] = "*";
	fs.writeFileSync(packageFilePath, JSON.stringify(packageJson,null, 4), "utf8");
}

function addEjsRequireToApp(path){
	var appJs = fs.readFileSync(path + "/app.js", "utf8");
	appJs = appJs.replace(", path = require('path');", ", expressLayouts = require('express-ejs-layouts')\n  , path = require('path');")
	appJs = appJs.replace("app.use(app.router);", "app.use(expressLayouts);\n  app.use(app.router);");
	fs.writeFileSync(path + "/app.js" ,appJs);
}